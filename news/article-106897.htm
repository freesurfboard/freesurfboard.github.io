<!DOCTYPE html>
<html xml:lang="zh-CN" lang="zh-CN">

<head>
        <link rel="canonical" href="https://freesurfboard.github.io/news/article-106897.htm" />
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Android中Handler的使用方法</title>
        <meta name="description" content="Android中Handler的使用方法 几乎所有人第一次使用到Handler类的时候，都是因为想在非主线程更新UI，然后在更新UI的时候报错，才发现Handler的，现在来看一下网上的通用给法  “" />
        <link rel="icon" href="/assets/website/img/freesurfboard/favicon.ico" type="image/x-icon"/>

    <meta name="author" content="Free Surfboard官方订阅站">
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://freesurfboard.github.io/news/article-106897.htm" />
    <meta property="og:site_name" content="Free Surfboard官方订阅站" />
    <meta property="og:title" content="Android中Handler的使用方法" />
    <meta property="og:image" content="https://freesurfboard.github.io/uploads/20240726-2/aa4ee52e7ce97e3baead65900a376478.webp" />
        <meta property="og:release_date" content="2025-04-29T08:01:42" />
    <meta property="og:updated_time" content="2025-04-29T08:01:42" />
        <meta property="og:description" content="Android中Handler的使用方法 几乎所有人第一次使用到Handler类的时候，都是因为想在非主线程更新UI，然后在更新UI的时候报错，才发现Handler的，现在来看一下网上的通用给法  “" />
        
    <meta name="applicable-device" content="pc,mobile" />
    <meta name="renderer" content="webkit" />
    <meta name="force-rendering" content="webkit" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta name="robots" content="max-image-preview:large" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Android中Handler的使用方法">
    <meta name="format-detection" content="telephone=no">

    <link rel="dns-prefetch" href="https:/www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://www.googleadservices.com">
    <link rel="dns-prefetch" href="https://www.google-analytics.com">
    <link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">
    <link rel="dns-prefetch" href="https://cm.g.doubleclick.net">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,600;1,700&display=swap" rel="stylesheet">
    <!-- Vendor CSS Files -->
    <link href="/assets/website/js/frontend/freesurfboard/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/website/js/frontend/freesurfboard/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="/assets/website/js/frontend/freesurfboard/aos/aos.css" rel="stylesheet">
    <link href="/assets/website/js/frontend/freesurfboard/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="/assets/website/js/frontend/freesurfboard/swiper/swiper-bundle.min.css" rel="stylesheet">
    <!-- Variables CSS Files. Uncomment your preferred color scheme -->
    <link href="/assets/website/css/freesurfboard/variables.css" rel="stylesheet">
    <!-- Template Main CSS File -->
    <link href="/assets/website/css/freesurfboard/main.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/website/css/G.css" />
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GEDHRZQGGF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GEDHRZQGGF');
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3332997411212854"
     crossorigin="anonymous"></script>
</head>

<body data-page="detail">
    <!-- ======= Header ======= -->
    <header id="header" class="header fixed-top" data-scrollto-offset="0">
        <div class="container-fluid d-flex align-items-center justify-content-between">
            <a href="/" class="logo d-flex align-items-center scrollto me-auto me-lg-0">
                        <span>Free Surfboard</span>
                        </a>
            <nav id="navbar" class="navbar">
                <ul>
                                        <li><a class="nav-link" href="/">首页</a></li>
                                        <li><a class="nav-link" href="/free-nodes/">免费节点</a></li>
                                        <li><a class="nav-link" href="/paid-subscribe/">推荐机场</a></li>
                                        <li><a class="nav-link" href="/client.htm">客户端</a></li>
                                        <li><a class="nav-link" href="/news/">新闻资讯</a></li>
                                    </ul>
                <i class="bi bi-list mobile-nav-toggle d-none"></i>
            </nav><!-- .navbar -->
        </div>
    </header><!-- End Header -->
    <main id="main">
        <!-- ======= Breadcrumbs ======= -->
        <div class="breadcrumbs">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center">
                    <h1>Android中Handler的使用方法</h1>
                    <ol>
                        <li><a href="/">首页</a></li>
                        <li><a href="/news/">新闻资讯</a></li>
                        <li>正文</li>
                    </ol>
                </div>
            </div>
        </div><!-- End Breadcrumbs -->
        <!-- ======= About Section ======= -->
        <section id="about" class="about">
            <div class="container" data-aos="fade-up">
                <div class="row">
                    <div class="col-md-9">
                                        <input type="hidden" id="share-website-info" data-name="" data-url="">
                <div class="xcblog-blog-detail xcblog-blog-detail-defined">
                      				  				  				<div id="content_views" class="markdown_views prism-atom-one-dark"> <h2 id="android中handler的使用方法">Android中Handler的使用方法</h2> <p>几乎所有人第一次使用到Handler类的时候，都是因为想在非主线程更新UI，然后在更新UI的时候报错，才发现Handler的，现在来看一下网上的通用给法 <br /> “</p> <pre><code>public class HandlerActivity extends Activity {  private Handler mHandler=new Handler(){     @Override     public void handleMessage(Message msg) {         switch(msg.what){             case 1:             //更新UI             break;          }         super.handleMessage(msg);     } }; @Override protected void onCreate(Bundle savedInstanceState) {     super.onCreate(savedInstanceState);      new Thread(new Runnable() {         @Override         public void run() {             Message msg=new Message();             msg.what=1;             mHandler.sendMessage(msg);         }     }).start(); } </code></pre> <p>} <br /> “ <br /> 我们通过新建一个Handler对象，然后在子线程中进行业务处理，当处理完成中再将信号通过mHandler发送到主线程中，Handler再收到消息后就会对其进行处理。在使用Android Studio的时候，细心的同学会发现，Handler中给出了警告提示： <br /> Since this Handler is declared as an inner class, it may prevent the outer class from being garbage collected. If the Handler is using a Looper or MessageQueue for a thread other than the main thread, then there is no issue. If the Handler is using the Looper or MessageQueue of the main thread, you need to fix your Handler declaration, as follows: Declare the Handler as a static class; In the outer class, instantiate a WeakReference to the outer class and pass this object to your Handler when you instantiate the Handler; Make all references to members of the outer class using the WeakReference object. <br /> 一旦Handler被声明为内部类，可能导致它的外部类不能被垃圾回收。如果Handler是在其他线程使用Looper或MessageQueue，而不是在UI线程，那么就没有这个问题。如果Handler使用Looper或MessageQueue在主线程（main thread），你需要修改你的Handler声明： <br /> 声明Handler为static类；在外部类中实例化一个外部类的WeakReference（弱引用）并且在Handler初始化时传入这个对象给你的Handler；将所有引用的外部类成员使用WeakReference对象。</p> <p>出现这个问题的主要原因是，当结束Activity时由于外部对handler 有一个引用，而handler 持有Activity的引用，这样就导致了GC不会回收，引发内存泄露，GC的回收机制是，如果某个对象不再被引用，那么该对象将被回收。如 A a=new A（），此时就创建一个对象A，a去引用，但是如果我们将a=null;后，由于对象A不再被引用，对象A就会被回收。所以，如一些需要在对象销毁时才执行的函数，如Activity的onDestroy，由于Activity没有被回收，导致内存泄露 ，引发的并发问题onDestroy不能被执行，有时候当某个函数不能被正常调用时，应该考虑是否内存泄露引发的，其实这种问题在C/C++中经常出现，只是java 弱化了指针的概念（或者说没有指针这个东西），导致JAVA中对内存泄露不是特别重视。</p> <p>说了这么多废话 该说一下如何解决了，根据这个警告提到的我们可以使用弱引用，来解决这个问题。使用静态内部类，通过WeakReference实现对Activity的弱引用，直接上代码： <br /> “</p> <pre><code>public class HandlerActivity extends Activity {  private static class WeakReferenceHandler extends Handler{     WeakReference&lt;HandlerActivity&gt; mActivity;     private String TAG="StudentSocreHandler";     public WeakReferenceHandler(HandlerActivity activity){         mActivity=new WeakReference&lt;&gt;(activity);     }     @Override     public void handleMessage(Message msg) {         HandlerActivity mHandlerActivity=mActivity.get();         switch (msg.what){             case 1:                 //更新UI 通过mHandlerActivity得到Activity中的对象                  break;         }         super.handleMessage(msg);     } } private WeakReferenceHandler mWeakReferenceHandler=new WeakReferenceHandler(this); @Override protected void onCreate(Bundle savedInstanceState) {     super.onCreate(savedInstanceState);     Work.WorkThread(mWeakReferenceHandler); } } </code></pre> <p><code> <br /></code></p> <pre><code>class Work{         public static void WorkThread(final Handler mHandler){             new Thread(new Runnable() {                 @Override                 public void run() {                     Message msg=new Message();                     msg.what=1;                     mHandler.sendMessage(msg);                 }             }).start();         }     } </code></pre> <p>“ <br /> WeakReference的作用就是将Activity进行弱引用，一旦Activity要被销毁时，由于Handler对Activity持有的引用是弱引用，此时，GC会及时回收Activity,防止内存泄露这就是使用弱引用的好处。但是并不是任何地方都能随便使用弱引用的，使用不当很容易造成空指针异常，所以需要合理的使用。</p> <p><strong>借鉴文章：</strong> <br />谈谈java中的WeakReference <br />Android实战技巧之三十八：Handler使用中可能引发的内存泄漏 该文章提到的另一种实现方法大家不防去试试</p> </p></div> 			                </div>
                <div class="clearfix"></div>
                <div class="col-md-12 mt-5">
                                        <p>上一个：<a href="/news/article-106024.htm">动物疫苗的类型包括（动物疫苗的类型包括什么）</a></p>
                                        <p>下一个：<a href="/news/article-106899.htm">Java并发 &#8211; 并发容器类</a></p>
                                    </div>
                                    </div>
                    <div class="col-md-3">
                        <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">热门文章</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2"><a href="/free-nodes/2025-3-21-node-share.htm" title="3月21日 - 最高速度22.6M/S，2025年Surfboard每天更新免费节点订阅链接，干净IP机场推荐">3月21日 - 最高速度22.6M/S，2025年Surfboard每天更新免费节点订阅链接，干净IP机场推荐</a></li>
                        <li class="py-2"><a href="/free-nodes/2025-4-13-free-surfboard-node.htm" title="4月13日 - 最高速度20M/S，2025年Surfboard每天更新免费节点订阅链接，干净IP机场推荐">4月13日 - 最高速度20M/S，2025年Surfboard每天更新免费节点订阅链接，干净IP机场推荐</a></li>
                        <li class="py-2"><a href="/news/article-67456.htm" title="不适合养猫的属相是（属什么不能养猫）">不适合养猫的属相是（属什么不能养猫）</a></li>
                        <li class="py-2"><a href="/news/article-80107.htm" title="宠物粮食加工厂设备哪的好一点呢知乎（宠物粮食加工设备贵吗）">宠物粮食加工厂设备哪的好一点呢知乎（宠物粮食加工设备贵吗）</a></li>
                        <li class="py-2"><a href="/free-nodes/2025-3-30-surfboard-node.htm" title="3月30日 - 最高速度19.1M/S，2025年Surfboard每天更新免费节点订阅链接，干净IP机场推荐">3月30日 - 最高速度19.1M/S，2025年Surfboard每天更新免费节点订阅链接，干净IP机场推荐</a></li>
                        <li class="py-2"><a href="/news/article-96117.htm" title="养猫容易引起哪些疾病（养猫容易得啥病）">养猫容易引起哪些疾病（养猫容易得啥病）</a></li>
                        <li class="py-2"><a href="/free-nodes/2025-3-19-linux-surfboard-node.htm" title="3月19日 - 最高速度20.1M/S，2025年Surfboard每天更新免费节点订阅链接，干净IP机场推荐">3月19日 - 最高速度20.1M/S，2025年Surfboard每天更新免费节点订阅链接，干净IP机场推荐</a></li>
                        <li class="py-2"><a href="/news/article-76687.htm" title="一篇文章带你彻底吃透Spring">一篇文章带你彻底吃透Spring</a></li>
                        <li class="py-2"><a href="/free-nodes/2025-3-20-free-subscribe-node.htm" title="3月20日 - 最高速度22.7M/S，2025年Surfboard每天更新免费节点订阅链接，干净IP机场推荐">3月20日 - 最高速度22.7M/S，2025年Surfboard每天更新免费节点订阅链接，干净IP机场推荐</a></li>
                        <li class="py-2"><a href="/news/article-70030.htm" title="动物医院实践心得500字内容是什么 动物医院实践心得500字内容是什么意思">动物医院实践心得500字内容是什么 动物医院实践心得500字内容是什么意思</a></li>
                    </ul>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">归纳</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">81</span> <a href="/date/2025-04/" title="2025-04 归档">2025-04</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">89</span> <a href="/date/2025-03/" title="2025-03 归档">2025-03</a></h4>
            </li>
                    </ul>
    </div>
</div>

                    </div>
                </div>
            </div>
        </section><!-- End About Section -->
    </main><!-- End #main -->
        <!-- ======= Footer ======= -->
    <footer id="footer" class="footer">
        <div class="footer-legal text-center">
            <div class="container d-flex flex-column flex-lg-row justify-content-center justify-content-lg-between align-items-center">
                <div class="d-flex flex-column align-items-center align-items-lg-start">
                    <div class="copyright">
                                            <p>
                                                <a href="/">首页</a> |
                                                <a href="/free-nodes/">免费节点</a> |
                                                <a href="/paid-subscribe/">推荐机场</a> |
                                                <a href="/client.htm">客户端</a> |
                                                <a href="/news/">新闻资讯</a> |
                                                <a href="/about-us.htm">关于我们</a> |
                        <a href="/disclaimer.htm">免责申明</a> |
                        <a href="/privacy.htm">隐私申明</a> |
                        <a href="/sitemap.xml">网站地图</a>
                    </p>
                        <a href="/">Free Surfboard官方订阅站</a> 版权所有 Powered by WordPress
                    </div>
                </div>
            </div>
        </div>
    </footer><!-- End Footer -->
    <a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
    <div id="preloader"></div>
    <!-- Vendor JS Files -->
    <script src="/assets/website/js/frontend/freesurfboard/jquery-3.2.1.min.js"></script>
    <script src="/assets/website/js/frontend/freesurfboard/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/website/js/frontend/freesurfboard/aos/aos.js"></script>
    <script src="/assets/website/js/frontend/freesurfboard/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="/assets/website/js/frontend/freesurfboard/swiper/swiper-bundle.min.js"></script>
    <script src="/assets/website/js/frontend/freesurfboard/php-email-form/validate.js"></script>
    <!-- Template Main JS File -->
    <script src="/assets/website/js/frontend/freesurfboard/main.js"></script>
    <script src="https://www.freeclashnode.com/assets/js/frontend/invite-url.js"></script>
    <script src="/assets/website/js/frontend/G.js"></script>
</body>

</html>